<div class="product-list">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1 class="title">
        <i class="bi bi-box"></i>
        {{ isVendorView ? 'My Products' : 'Products' }}
      </h1>
      
      <div class="actions">
        <button 
          class="btn btn-primary"
          routerLink="/products/new">
          <i class="bi bi-plus-circle"></i>
          Add Product
        </button>
        
        <div class="btn-group" role="group">
          <button 
            type="button" 
            class="btn btn-outline-secondary"
            (click)="toggleFilters()">
            <i class="bi bi-filter"></i>
            Filters
            <span *ngIf="hasActiveFilters()" class="badge bg-primary ms-1">
              {{ countActiveFilters() }}
            </span>
          </button>
          <button 
            type="button" 
            class="btn btn-outline-secondary"
            (click)="exportProducts()">
            <i class="bi bi-download"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div *ngIf="showFilters" class="filters">
      <div class="filter-row">
        <div class="filter-group">
          <label for="search">Search</label>
          <input 
            type="text" 
            id="search" 
            [(ngModel)]="filters.search"
            placeholder="Product name, SKU, description..."
            (keyup.enter)="applyFilters()"
            class="form-control">
        </div>
        
        <div class="filter-group">
          <label for="category_id">Category</label>
          <select 
            id="category_id" 
            [(ngModel)]="filters.category_id"
            class="form-select">
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="is_featured">Featured</label>
          <select 
            id="is_featured" 
            [(ngModel)]="filters.is_featured"
            class="form-select">
            <option value="">All</option>
            <option [value]="true">Featured Only</option>
            <option [value]="false">Not Featured</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="sort_by">Sort By</label>
          <select 
            id="sort_by" 
            [(ngModel)]="filters.sort_by"
            class="form-select">
            <option value="">Default</option>
            <option value="name">Name</option>
            <option value="price">Price</option>
            <option value="created_at">Date Added</option>
          </select>
        </div>
      </div>
      
      <div class="filter-row" *ngIf="isVendorView">
        <div class="filter-group">
          <label for="is_active">Status</label>
          <select 
            id="is_active" 
            [(ngModel)]="filters.is_active"
            class="form-select">
            <option value="">All Status</option>
            <option [value]="true">Active</option>
            <option [value]="false">Inactive</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="stock_status">Stock Status</label>
          <select 
            id="stock_status" 
            [(ngModel)]="filters.stock_status"
            class="form-select">
            <option value="">All</option>
            <option value="in_stock">In Stock</option>
            <option value="out_of_stock">Out of Stock</option>
            <option value="low_stock">Low Stock</option>
          </select>
        </div>
      </div>
      
      <div class="filter-actions">
        <button 
          class="btn btn-secondary"
          (click)="resetFilters()">
          <i class="bi bi-x-circle"></i>
          Clear Filters
        </button>
        <button 
          class="btn btn-primary"
          (click)="applyFilters()">
          <i class="bi bi-check-circle"></i>
          Apply Filters
        </button>
      </div>
    </div>

    <!-- Vendor Stats Bar -->
    <div *ngIf="isVendorView && stats" class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">Total Products</div>
        <div class="stat-value">{{ stats.total_products || 0 }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Active Products</div>
        <div class="stat-value">{{ stats.active_products || 0 }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Out of Stock</div>
        <div class="stat-value">{{ stats.out_of_stock || 0 }}</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Total Value</div>
        <div class="stat-value">${{ stats.total_value || 0 | number:'1.2-2' }}</div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading products...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="error alert alert-danger">
      <i class="bi bi-exclamation-triangle"></i>
      {{ error }}
      <button class="btn btn-sm btn-outline-primary ms-2" (click)="loadProducts()">
        Retry
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !error && products.length === 0" class="empty-state">
      <i class="bi bi-box"></i>
      <h3>No Products Found</h3>
      <p>There are no products matching your criteria. Try adjusting your filters or create a new product.</p>
      <button 
        class="btn btn-primary"
        routerLink="/products/new">
        <i class="bi bi-plus-circle"></i>
        Create Your First Product
      </button>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!isLoading && !error && products.length > 0" class="products-grid">
      <div *ngFor="let product of products" class="product-card card">
        <div class="card-header">
          <img 
            [src]="getProductImage(product)" 
            [alt]="product.name"
            class="product-image"
            (error)="onImageError($event)">
          
          <div class="badges">
            <span *ngIf="product.is_featured" class="badge featured">
              <i class="bi bi-star"></i> Featured
            </span>
            <span *ngIf="!product.is_active" class="badge inactive">
              <i class="bi bi-eye-slash"></i> Inactive
            </span>
            <span *ngIf="getQuantity(product) === 0" class="badge out-of-stock">
              <i class="bi bi-x-circle"></i> Out of Stock
            </span>
            <span *ngIf="getQuantity(product) > 0 && getQuantity(product) <= 10" class="badge low-stock">
              <i class="bi bi-exclamation-triangle"></i> Low Stock
            </span>
          </div>
        </div>
        
        <div class="card-body">
          <h5 class="product-title">
            <a [routerLink]="['/products', product.slug || product.id]" class="text-decoration-none">
              {{ product.name }}
            </a>
          </h5>
          
          <div class="product-category" *ngIf="product.category">
            <i class="bi bi-tag"></i>
            {{ product.category.name || 'Uncategorized' }}
          </div>
          
          <p class="product-description" *ngIf="product.description">
            {{ (product.description || '') | slice:0:100 }}...
          </p>
          
          <div class="product-price">
            <span class="current-price">${{ getPrice(product) | number:'1.2-2' }}</span>
            <span *ngIf="product.compare_price" class="compare-price">
              ${{ product.compare_price | number:'1.2-2' }}
            </span>
          </div>
          
          <div class="product-stock">
            <span class="stock-status" [class]="isInStock(product) ? 'in-stock' : 'out-of-stock'">
              <i [class]="isInStock(product) ? 'bi bi-check-circle' : 'bi bi-x-circle'"></i>
              {{ isInStock(product) ? 'In Stock' : 'Out of Stock' }}
            </span>
            <span class="quantity">
              {{ getQuantity(product) }} units
            </span>
          </div>
        </div>
        
        <div class="card-footer">
          <div class="actions">
            <button 
              class="btn btn-sm btn-outline-primary"
              [routerLink]="['/products', product.id, 'edit']"
              [title]="'Edit ' + product.name">
              <i class="bi bi-pencil"></i>
            </button>
            
            <button 
              class="btn btn-sm btn-outline-success"
              [routerLink]="['/products', product.slug || product.id]"
              [title]="'View ' + product.name">
              <i class="bi bi-eye"></i>
            </button>
            
            <button 
              class="btn btn-sm btn-outline-warning"
              (click)="toggleActive(product)"
              [title]="product.is_active ? 'Deactivate' : 'Activate'">
              <i [class]="product.is_active ? 'bi bi-toggle-on' : 'bi bi-toggle-off'"></i>
            </button>
            
            <button 
              class="btn btn-sm btn-outline-danger"
              (click)="deleteProduct(product.id!)"
              [title]="'Delete ' + product.name">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && !error && products.length > 0 && totalPages > 1" class="pagination">
      <nav>
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="goToPage(currentPage - 1)">
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>
          
          <li *ngFor="let page of getPaginationPages()" 
              class="page-item" 
              [class.active]="page === currentPage">
            <a class="page-link" (click)="goToPage(page)">
              {{ page }}
            </a>
          </li>
          
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="goToPage(currentPage + 1)">
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
      <div class="pagination-info">
        Page {{ currentPage }} of {{ totalPages }}
      </div>
    </div>
  </div>
</div>