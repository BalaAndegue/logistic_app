<!-- src/app/components/users/user-form/user-form.component.html -->
<form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
    <div class="form-header">
        <h3>
            <i class="bi" [ngClass]="isEditing ? 'bi-pencil-square' : 'bi-person-plus'"></i>
            {{ isEditing ? 'Edit User' : 'Create New User' }}
        </h3>
        <button type="button" class="btn-close" (click)="onCancel()" aria-label="Close"></button>
    </div>

    <div class="form-body">
        <!-- Name Field -->
        <div class="form-group">
            <label for="name" class="form-label">
                <i class="bi bi-person"></i> Full Name *
            </label>
            <input 
                type="text" 
                id="name" 
                formControlName="name" 
                class="form-control"
                placeholder="Enter full name"
                [ngClass]="{
                    'is-invalid': userForm.get('name')?.invalid && 
                                 (userForm.get('name')?.touched || userForm.get('name')?.dirty)
                }"
            >
            <div *ngIf="userForm.get('name')?.invalid && 
                       (userForm.get('name')?.touched || userForm.get('name')?.dirty)" 
                 class="invalid-feedback">
                <span *ngIf="userForm.get('name')?.errors?.['required']">
                    Name is required
                </span>
                <span *ngIf="userForm.get('name')?.errors?.['minlength']">
                    Name must be at least 2 characters
                </span>
            </div>
        </div>

        <!-- Email Field -->
        <div class="form-group">
            <label for="email" class="form-label">
                <i class="bi bi-envelope"></i> Email Address *
            </label>
            <input 
                type="email" 
                id="email" 
                formControlName="email" 
                class="form-control"
                placeholder="user@example.com"
                [ngClass]="{
                    'is-invalid': userForm.get('email')?.invalid && 
                                 (userForm.get('email')?.touched || userForm.get('email')?.dirty)
                }"
            >
            <div *ngIf="userForm.get('email')?.invalid && 
                       (userForm.get('email')?.touched || userForm.get('email')?.dirty)" 
                 class="invalid-feedback">
                <span *ngIf="userForm.get('email')?.errors?.['required']">
                    Email is required
                </span>
                <span *ngIf="userForm.get('email')?.errors?.['email']">
                    Please enter a valid email address
                </span>
            </div>
        </div>

        <!-- Role Field -->
        <div class="form-group">
            <label for="role" class="form-label">
                <i class="bi bi-person-badge"></i> Role *
            </label>
            <select 
                id="role" 
                formControlName="role" 
                class="form-select"
                [ngClass]="{
                    'is-invalid': userForm.get('role')?.invalid && 
                                 (userForm.get('role')?.touched || userForm.get('role')?.dirty)
                }"
            >
                <option value="" disabled>Select a role</option>
                <option *ngFor="let role of roles" [value]="role">
                    {{ role | titlecase }}
                </option>
            </select>
            <div *ngIf="userForm.get('role')?.invalid && 
                       (userForm.get('role')?.touched || userForm.get('role')?.dirty)" 
                 class="invalid-feedback">
                Role is required
            </div>
        </div>

        <!-- Phone Field -->
        <div class="form-group">
            <label for="phone" class="form-label">
                <i class="bi bi-telephone"></i> Phone Number (Optional)
            </label>
            <input 
                type="tel" 
                id="phone" 
                formControlName="phone" 
                class="form-control"
                placeholder="+237 XXX XXX XXX"
            >
            <small class="form-text text-muted">Leave blank if not applicable</small>
        </div>

        <!-- Password Field -->
        <div class="form-group">
            <label for="password" class="form-label">
                <i class="bi bi-key"></i> 
                {{ isEditing ? 'New Password (Optional)' : 'Password *' }}
            </label>
            <input 
                type="password" 
                id="password" 
                formControlName="password" 
                class="form-control"
                placeholder="{{ isEditing ? 'Leave blank to keep current password' : 'Enter password' }}"
                [ngClass]="{
                    'is-invalid': userForm.get('password')?.invalid && 
                                 (userForm.get('password')?.touched || userForm.get('password')?.dirty)
                }"
            >
            <div *ngIf="userForm.get('password')?.invalid && 
                       (userForm.get('password')?.touched || userForm.get('password')?.dirty)" 
                 class="invalid-feedback">
                <span *ngIf="userForm.get('password')?.errors?.['required'] && !isEditing">
                    Password is required for new users
                </span>
                <span *ngIf="userForm.get('password')?.errors?.['minlength']">
                    Password must be at least 6 characters
                </span>
            </div>
            <small *ngIf="isEditing" class="form-text text-muted">
                Only fill if you want to change the password
            </small>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group" *ngIf="userForm.get('password')?.value">
            <label for="password_confirmation" class="form-label">
                <i class="bi bi-key-fill"></i> Confirm Password
            </label>
            <input 
                type="password" 
                id="password_confirmation" 
                formControlName="password_confirmation" 
                class="form-control"
                placeholder="Confirm the password"
                [ngClass]="{
                    'is-invalid': userForm.hasError('mismatch') && 
                                 userForm.get('password_confirmation')?.touched
                }"
            >
            <div *ngIf="userForm.hasError('mismatch') && 
                       userForm.get('password_confirmation')?.touched" 
                 class="invalid-feedback">
                Passwords do not match
            </div>
        </div>

        <!-- Form Errors -->
        <div *ngIf="userForm.errors?.['mismatch'] && userForm.get('password_confirmation')?.touched" 
             class="alert alert-danger mt-3">
            <i class="bi bi-exclamation-triangle"></i>
            Passwords do not match. Please make sure both password fields are identical.
        </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
        <button 
            type="submit" 
            [disabled]="userForm.invalid || loading" 
            class="btn btn-primary btn-submit"
        >
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi" [ngClass]="isEditing ? 'bi-check-lg' : 'bi-plus-lg'"></i>
            {{ loading ? 'Processing...' : (isEditing ? 'Update User' : 'Create User') }}
        </button>
        <button 
            type="button" 
            (click)="onCancel()" 
            class="btn btn-outline-secondary"
            [disabled]="loading"
        >
            <i class="bi bi-x-lg"></i> Cancel
        </button>
    </div>

    <!-- Help Text -->
    <div class="form-help">
        <small class="text-muted">
            <i class="bi bi-info-circle"></i>
            Fields marked with * are required.
            {{ isEditing ? 'Password change is optional.' : 'A password is required for new users.' }}
        </small>
    </div>
</form>