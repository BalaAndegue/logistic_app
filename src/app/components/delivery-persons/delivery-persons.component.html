<div class="delivery-persons-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h2>Gestion des Livreurs</h2>
      <p class="subtitle">Gérez et suivez vos livreurs en temps réel</p>
    </div>
    <button 
      *ngIf="canCreate" 
      class="btn btn-primary"
      (click)="openCreateModal()">
      <i class="bi bi-plus-circle"></i>
      Nouveau Livreur
    </button>
  </div>

 
  <div class="stats-grid">
    <div class="card stat-card available">
      <div class="icon-wrapper">
        <i class="bi bi-person-check"></i>
      </div>
      <div class="stat-info">
        <h3>{{ getAvailableCount() }}</h3>
        <p>Disponibles</p>
      </div>
    </div>
    
    <div class="card stat-card busy">
      <div class="icon-wrapper">
        <i class="bi bi-bicycle"></i>
      </div>
      <div class="stat-info">
        <h3>{{ getBusyCount() }}</h3>
        <p>En livraison</p>
      </div>
    </div>
    
    <div class="card stat-card total">
      <div class="icon-wrapper">
        <i class="bi bi-people"></i>
      </div>
      <div class="stat-info">
        <h3>{{ drivers.length }}</h3>
        <p>Total livreurs</p>
      </div>
    </div>
    
    <div class="card stat-card rating">
      <div class="icon-wrapper">
        <i class="bi bi-star"></i>
      </div>
      <div class="stat-info">
        <h3>{{ getAverageRating() }}</h3>
        <p>Note moyenne</p>
      </div>
    </div>
  </div>

  
  <div class="card filters-section">
    <div class="filters-content">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input 
          type="text" 
          placeholder="Rechercher un livreur..."
          [(ngModel)]="searchTerm"
          (input)="filterDrivers()">
      </div>
      
      <div class="filter-buttons">
        <button 
          class="filter-btn"
          [class.active]="statusFilter === 'all'"
          (click)="setStatusFilter('all')">
          Tous
        </button>
        <button 
          class="filter-btn"
          [class.active]="statusFilter === 'available'"
          (click)="setStatusFilter('available')">
          <i class="bi bi-circle-fill available-dot"></i>
          Disponibles
        </button>
        <button 
          class="filter-btn"
          [class.active]="statusFilter === 'busy'"
          (click)="setStatusFilter('busy')">
          <i class="bi bi-circle-fill busy-dot"></i>
          Occupés
        </button>
      </div>
    </div>
  </div>

  <div class="card table-card">
    <div class="table-header">
      <h3>Liste des Livreurs</h3>
      <span class="count-badge">{{ filteredDrivers.length }} livreur(s)</span>
    </div>

    <div class="table-container" *ngIf="!loading; else loadingTpl">
      <table class="drivers-table">
        <thead>
          <tr>
            <th>Livreur</th>
            <th>Contact</th>
            <th>Adresse</th>
            <th>Statut</th>
            <th>Livraisons</th>
            <th>Note</th>
            <th *ngIf="canEdit || canDelete">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let driver of filteredDrivers" class="driver-row">
            <!-- Nom et photo -->
            <td>
              <div class="driver-info">
                <div class="driver-avatar">
                  {{ getInitialsFromName(driver.name || '') }}
                </div>
                <div class="driver-details">
                  <span class="driver-name">
                    {{ driver.name }}
                  </span>
                  <span class="driver-id">#{{ driver.id }}</span>
                </div>
              </div>
            </td>

            
            <td>
              <div class="contact-info">
                <div class="contact-item">
                  <i class="bi bi-envelope"></i>
                  <span>{{ driver.email }}</span>
                </div>
                <div class="contact-item" *ngIf="driver.phone">
                  <i class="bi bi-telephone"></i>
                  <span>{{ driver.phone }}</span>
                </div>
              </div>
            </td>

         
            <td>
              <div class="address-info">
                <i class="bi bi-geo-alt"></i>
                <span>{{ driver.address || 'Non renseignée' }}</span>
              </div>
            </td>

           
            <td>
              <span class="status-badge" [class.available]="driver.isAvailable" [class.busy]="!driver.isAvailable">
                <i class="bi bi-circle-fill"></i>
                {{ driver.isAvailable ? 'Disponible' : 'Occupé' }}
              </span>
            </td>

       
            <td>
              <div class="delivery-stats">
                <span class="stat-item active">
                  <i class="bi bi-box"></i>
                  {{ driver.activeDeliveries || 0 }}
                </span>
                <span class="stat-item total">
                  Total: {{ driver.totalDeliveries || 0 }}
                </span>
              </div>
            </td>

           
            <td>
              <div class="rating">
                <i class="bi bi-star-fill"></i>
                <span class="rating-value">{{ driver.rating || 5.0 }}</span>
                <span class="rating-max">/5</span>
              </div>
            </td>

         
            <td *ngIf="canEdit || canDelete">
              <div class="action-buttons">
                <button 
                  *ngIf="canEdit"
                  class="btn-icon btn-edit" 
                  (click)="openEditModal(driver)"
                  title="Modifier">
                  <i class="bi bi-pencil"></i>
                </button>
                <button 
                  *ngIf="canDelete"
                  class="btn-icon btn-delete" 
                  (click)="deleteDriver(driver)"
                  title="Supprimer">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="empty-state" *ngIf="filteredDrivers.length === 0">
        <i class="bi bi-inbox"></i>
        <h3>Aucun livreur trouvé</h3>
        <p>{{ searchTerm ? 'Aucun résultat pour votre recherche' : 'Commencez par ajouter un livreur' }}</p>
        <button 
          *ngIf="canCreate && !searchTerm" 
          class="btn btn-primary"
          (click)="openCreateModal()">
          <i class="bi bi-plus-circle"></i>
          Ajouter un livreur
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i [class]="isEditMode ? 'bi bi-pencil-square' : 'bi bi-plus-circle'"></i>
        {{ isEditMode ? 'Modifier' : 'Nouveau' }} Livreur
      </h3>
      <button class="btn-close" (click)="closeModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <form class="modal-body" #driverForm="ngForm" (ngSubmit)="onSubmit(driverForm)">
     
      <div class="form-section">
        <h4>Informations personnelles</h4>
        
        <div class="form-group">
          <label for="name">
            <i class="bi bi-person"></i>
            Nom complet <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="name"
            name="name"
            [(ngModel)]="formData.name"
            required
            placeholder="Marcelle NANKENG">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">
              <i class="bi bi-envelope"></i>
              Email <span class="required">*</span>
            </label>
            <input 
              type="email" 
              id="email"
              name="email"
              [(ngModel)]="formData.email"
              required
              placeholder="delivery@shopcart.com">
          </div>

          <div class="form-group">
            <label for="phone">
              <i class="bi bi-telephone"></i>
              Téléphone <span class="required">*</span>
            </label>
            <input 
              type="tel" 
              id="phone"
              name="phone"
              [(ngModel)]="formData.phone"
              required
              placeholder="+237 659 03 18 46">
          </div>
        </div>

        <div class="form-group">
          <label for="address">
            <i class="bi bi-geo-alt"></i>
            Adresse <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="address"
            name="address"
            [(ngModel)]="formData.address"
            required
            placeholder="Yaoundé, MELEN">
        </div>
      </div>

      
      <div class="form-section">
        <h4>{{ isEditMode ? 'Modifier le mot de passe (optionnel)' : 'Mot de passe' }}</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label for="password">
              <i class="bi bi-lock"></i>
              Mot de passe <span class="required" *ngIf="!isEditMode">*</span>
            </label>
            <input 
              type="password" 
              id="password"
              name="password"
              [(ngModel)]="formData.password"
              [required]="!isEditMode"
              minlength="8"
              placeholder="Minimum 8 caractères">
            <small *ngIf="isEditMode" class="form-hint">Laissez vide pour conserver le mot de passe actuel</small>
          </div>

          <div class="form-group">
            <label for="password_confirmation">
              <i class="bi bi-lock-fill"></i>
              Confirmer le mot de passe <span class="required" *ngIf="!isEditMode">*</span>
            </label>
            <input 
              type="password" 
              id="password_confirmation"
              name="password_confirmation"
              [(ngModel)]="formData.password_confirmation"
              [required]="!isEditMode"
              minlength="8"
              placeholder="Confirmer le mot de passe">
          </div>
        </div>
      </div>

     
      <div class="modal-footer">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="closeModal()">
          <i class="bi bi-x-circle"></i>
          Annuler
        </button>
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="!driverForm.valid">
          <i class="bi bi-check-circle"></i>
          {{ isEditMode ? 'Mettre à jour' : 'Créer' }}
        </button>
      </div>
    </form>
  </div>
</div>
<ng-template #loadingTpl>
  <div class="loading-state">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p>Chargement des livreurs...</p>
  </div>
</ng-template>

